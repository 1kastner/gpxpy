language: python

# Use container-based infrastructure
sudo: false

# Those without lxml wheels first because building lxml is slow
python:
 - 3.5
 - 3.2
 - 2.7
 - 2.6
 - 3.4
 - 3.3
 - 3.6

env:
- XMLPARSER=LXML
- XMLPARSER=STDLIB

install:
# Check whether to install lxml
 - if [ "$XMLPARSER" == "LXML" ]; then
     case "$TRAVIS_PYTHON_VERSION" in
       "3.2"|"3.5"|"3.6")
         pip install lxml
         ;;
       "2.6"|"2.7"|"3.3"|"3.4")
         wget -q -P /tmp "https://github.com/obspy/wheelhouse/raw/master/lxml-3.4.0-cp${TRAVIS_PYTHON_VERSION//.}-none-linux_x86_64.whl"
         pip install lxml --use-wheel --no-index --find-links=/tmp lxml
         ;;
     esac
   fi


 # Coveralls 4.0 doesn't support Python 3.2
 - if [ "$TRAVIS_PYTHON_VERSION" == "3.2" ]; then travis_retry pip install coverage==3.7.1; fi
 - if [ "$TRAVIS_PYTHON_VERSION" != "3.2" ]; then travis_retry pip install coverage; fi

 - if [ "$TRAVIS_PYTHON_VERSION" == "2.6" ]; then pip install unittest2; fi


script:
 - python -m unittest test
 - coverage run --source=gpxpy ./test.py

after_success:
 - pip install coveralls
 - coveralls

after_script:
 - coverage report
 - pip install pyflakes pep8
 - pyflakes . | tee >(wc -l)
 - pep8 --statistics --count .

matrix:
  fast_finish: true
